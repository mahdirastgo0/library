{% load static %}
<!-- jQuery -->
<script src="{% static 'js/jquery-1.11.0.min.js' %}"></script>
<!-- Bootstrap JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/js/bootstrap.bundle.min.js"></script>
<!-- Your custom JS -->
<script src="{% static 'js/plugins.js' %}"></script>
<script src="{% static 'js/script.js' %}"></script>
<script>
    function showAlert(message, isSuccess = true) {
        const alertDiv = document.createElement('div');
        alertDiv.className = isSuccess ? 'alert success' : 'alert error';
        alertDiv.textContent = message;
        document.body.appendChild(alertDiv);
        setTimeout(() => alertDiv.remove(), 3000);
    }

    async function addToCart(button) {
        const bookId = button.dataset.bookId;
        const csrfToken = button.dataset.csrf;
        let url = button.dataset.url;
        url = url.replace('0', bookId);

        const originalText = button.innerHTML;
        button.innerHTML = '<i class="bi bi-arrow-repeat spin"></i> در حال پردازش...';
        button.disabled = true;

        try {
            const response = await fetch(url, {
                method: 'POST',
                headers: {
                    'X-CSRFToken': csrfToken,
                    'Content-Type': 'application/json',
                },
                credentials: 'same-origin'
            });

            const data = await response.json();

            if (data.success) {
                showAlert(data.message || 'موفق');
                const cartCountElements = document.querySelectorAll('.cart-count');
                cartCountElements.forEach(el => el.textContent = data.cart_count);
            } else {
                throw new Error(data.error || 'خطا در افزودن به سبد');
            }
        } catch (error) {
            console.error('Error:', error);
            showAlert(error.message, false);
        } finally {
            button.innerHTML = originalText;
            button.disabled = false;
        }
    }

    document.addEventListener('DOMContentLoaded', function () {
        document.querySelectorAll('.add-to-cart').forEach(button => {
            button.addEventListener('click', function () {
                addToCart(this);
            });
        });
    });
</script>

